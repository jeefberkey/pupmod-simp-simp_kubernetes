---

lookup_options:
  simp_kubernetes::packages:
    merge: unique
  '^simp_kubernetes::\w+_ports$':
    merge:
      strategy: deep
      knockout_prefix: --

simp_kubernetes::is_master: false
simp_kubernetes::use_simp_docker: true
simp_kubernetes::manage_repo: true
simp_kubernetes::repo_enabled: true
simp_kubernetes::manage_packages: true
simp_kubernetes::package_ensure: installed
simp_kubernetes::manage_kubelet_sevice: false
simp_kubernetes::service_ensure: running

simp_kubernetes::kubelet_overrides: |
  Environment="KUBELET_CGROUP_ARGS=--cgroup-driver=systemd --runtime-cgroups=/systemd/system.slice --kubelet-cgroups=/systemd/system.slice"

simp_kubernetes::packages:
  - kubelet
  - kubeadm
  - kubectl
  - kubernetes-cni

simp_kubernetes::master_ports:
  defaults:
    proto: tcp
    apply_to: ipv4
  2379: # etcd
  2380: # etcd peers
  6443: # kube-apiserver
  8081: # kube-dns health check
  10250:
  10251:
  10252:
  10253:

simp_kubernetes::worker_ports:
  defaults:
    proto: tcp
    apply_to: ipv4
  8081:  # kube-dns health check
  10250: # kubelet -> kube-apiserver
  10255: # kubelet -> kube-apiserver
